$(function(){var e=$("#formElem").children().length,t=1,n=(!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/"),/constructor/i.test(window.HTMLElement)||(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),!!!document.documentMode&&window.StyleMedia,!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime)&&navigator.userAgent.indexOf("Edg"),0),i=$("#wrapper").width(),s=$("#wrapper").height(),o=new Array;function a(){n=0,o=new Array,$("#steps .step").each(function(e){var t=$(this);t.width(i),t.height(s),o[e]=n,n+=i}),$("#steps").width(n)}function r(t){if(t!=e){var n=1,i=!1;$("#formElem").children(":nth-child("+parseInt(t)+")").find(":input:not(button)").each(function(){var e=$(this);""==jQuery.trim(e.val()).length?(i=!0,e.css("background-color","#FFEDEF")):e.is(":disabled")||e.css("background-color","#FFFFFF")}),$("#navigation li:nth-child("+parseInt(t)+") a").parent().find(".error,.checked").remove();switch(i&&(n=-1,"error"),t){case 1:loadProjectDefData();break;case 2:loadLineCharacteristics()}return n}}function l(){var e;e="res/lang/"+locale+".json",$.ajax({global:!1,url:e,dataType:"json",success:function(e){strings=e,$("#titleBar").html(strings.title),$("#contentTitle").html(strings.title),$("#stepTitle_0").html(strings.projDef),$("#nav1").html(strings.projDef),$("#stepDesc_0").html(strings.projDef_desc),$("#projLabel").html(strings.project),$("#pname_lbl").html(strings.name),$("#proom_lbl").html(strings.room),$("#proom").attr("placeholder",strings.roomEG),$("#paddr_lbl").html(strings.address),$("#date_lbl").html(strings.date),$("#contactLabel").html(strings.contact),$("#cname_lbl").html(strings.name),$("#caddr_lbl").html(strings.address),$("#country_lbl").html(strings.country),$("#country_op0").html(strings.country_be),$("#country_op1").html(strings.country_lu),$("#country_op2").html(strings.country_fr),$("#country_op3").html(strings.country_de),$("#country_op4").html(strings.country_nl),$("#country_op5").html(strings.country_pt),$("#country_op6").html(strings.country_es),$("#country_op7").html(strings.country_se),$("#country_op8").html(strings.other),$("#phone_lbl").html(strings.phone),$("#phone").attr("placeholder",strings.phoneEG),$("#email_lbl").html(strings.mail),$("#email").attr("placeholder",strings.mailEG),$("#stepTitle_1").html(strings.lineDef),$("#nav2").html(strings.lineDef),$("#stepDesc_1").html(strings.lineDef_desc),$("#installation_lbl").html(strings.installation),$("#installation_op0").html(strings.ceiling),$("#installation_op1").html(strings.wall),$("#installation_op2").html(strings.suspended),$("#susLength_lbl").html(strings.susType+": "),$("#susLen_op0").html(strings.other),$("#susLen_op5").html(strings.other),$("#susLength_gr0").attr("label",strings.powerSupplyBox),$("#susLength_gr1").attr("label",strings.minimalistic),$("#color_lbl").html(strings.color),$("#color_op0").html(strings.color_op0),$("#color_op1").html(strings.color_op1),$("#color_op2").html(strings.color_op2),$("#color_op3").html(strings.other),$("#otherColorLabel2").html(strings.colorRemark),$("#ledcolor_lbl").html(strings.ledColor),$("#optics_lbl").html(strings.optics),$("#optics_gr0").attr("label",strings.diffuser),$("#optics_gr1").attr("label",strings.shielded),$("#optics_op0").html(strings.opalDiffuser),$("#optics_op2").html(strings.whiteShielding),$("#optics_op3").html(strings.blackShielding),$("#lightOutputLabel").html(strings.lightOutput+": "),$("#lightOutput_op0").html(strings.medium),$("#lightOutput_op1").html(strings.low),$("#beamLabel").html(strings.lightDistribution),$("#beam_op0").html(strings.medBeam),$("#beam_op1").html(strings.vWideBeam),$("#stepTitle_2").html(strings.lineDsgn),$("#nav3").html(strings.lineDsgn),$("#stepDesc_2").html(strings.lineDsgn_desc_diffusor),document.getElementById("optics").addEventListener("change",function(){"D"==getOptics().cod?$("#stepDesc_2").html(strings.lineDsgn_desc_diffusor):$("#stepDesc_2").html(strings.lineDsgn_desc_shield)},!1),$("#stepTitle_3").html(strings.lineConf),$("#nav4").html(strings.lineConf),$("#stepDesc_3").html(strings.lineConf_desc),$("#stepTitle_4").html(strings.projSumm),$("#nav5").html(strings.projSumm),$("#stepDesc_4").html(strings.projSumm_desc),$("#pOverview_title").html(strings.projOverview),$("#addInfo").html(strings.addInfo),$("#additionalnfo").attr("placeholder",strings.addInfoPH+"."),$("#leyTitle").html(strings.ley),$("#components_title").html(strings.components),$("#tenderTitle").html(strings.tenderTitle),$("#printPopup").html(strings.printPopup),$("#submitPopup").html(strings.submitPopup),$("#orderPopup").html(strings.orderPopup),$("#autocadPopup").html(strings.autocadPopup),$("#installationPopup").html(strings.installationPopup),5==t&&(loadOverviewData(),genOverviewTable(modules)),createChannelTable()}})}$("#formElem").children(":first").find(":input:first").focus(),$("#backward").hide(),$("#backward").bind("click",function(e){$("#nav"+(t-1)).trigger("click")}),$("#forward").bind("click",function(e){$("#nav"+(t+1)).trigger("click")}),$("#navigation").show(),$("#nav2, #nav3, #nav4, #nav5").bind("click",function(n){if(1==t&&(""==$("#email").val()||"blank"==$("#country :selected").val()))return r(t),void warningMsg(strings.warningTitle,strings.warningMsg);var i=$(this),s=t;i.closest("ul").find("li").removeClass("selected"),i.parent().addClass("selected"),t=i.parent().index()+1;for(var a=1;a<e;++a)a<t?$("#navlist").children(":nth-child("+a+")").addClass("prev"):$("#navlist").children(":nth-child("+a+")").removeClass("prev");switch($("#steps").stop().animate({marginLeft:"-"+o[t-1]+"px"},500,function(){for(var e=s;e<t;)r(e),e++;switch($("#formElem").children(":nth-child("+parseInt(t)+")").find(":input:first").focus(),t){case 1:$("#backward").hide();break;case 3:$("#designContainer").show(),$("#toolsWrapper").show(),designHasChanged=!1;break;case 4:$("#configContainer").show(),$("#tableWrap").show(),designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1);break;case 5:designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1),createPath(),$("#exportContainer").show(),$("#overviewContainer").show(),$("#submitPanel").show(),$("#forward").hide()}}),t){case 1:$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 2:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 3:$("#backward").show(),$("#forward").show(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 4:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 5:$("#backward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide()}n.preventDefault()}),$("#nav1").bind("click",function(n){if(1!=t||""!=$("#email").val()&&"blank"!=$("#country :selected").val()){var i=$(this),s=t;i.closest("ul").find("li").removeClass("selected"),i.parent().addClass("selected"),t=i.parent().index()+1;for(var a=1;a<e;++a)a<t?$("#navlist").children(":nth-child("+a+")").addClass("prev"):$("#navlist").children(":nth-child("+a+")").removeClass("prev");switch($("#steps").stop().animate({marginLeft:"-"+o[t-1]+"px"},500,function(){for(var e=s;e<t;)r(e),e++;switch($("#formElem").children(":nth-child("+parseInt(t)+")").find(":input:first").focus(),t){case 1:$("#backward").hide();break;case 3:$("#designContainer").show(),$("#toolsWrapper").show(),designHasChanged=!1;break;case 4:$("#configContainer").show(),$("#tableWrap").show(),designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1);break;case 5:designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1),createPath(),$("#exportContainer").show(),$("#overviewContainer").show(),$("#submitPanel").show(),$("#forward").hide()}}),t){case 1:$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 2:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 3:$("#backward").show(),$("#forward").show(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 4:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 5:$("#backward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide()}n.preventDefault()}else r(t)}),$("#country").keydown(function(e){9==e.which&&($("#navigation li:nth-child(2) a").click(),$(this).blur(),e.preventDefault())}),$(document).ready(function(){var e=new URLSearchParams(window.location.search);null!=e.get("lang")&&(console.log(e.get("lang")),locale=e.get("lang")),$("#langSel").val(locale),l(),a();var t=new Date;$("#date").val(t.toLocaleString("en-GB")),setUpDesignMap(),setUpConfigMap(),getCodesData()}),$("#langSel").change(function(){locale=$("#langSel :selected").val(),l()}),$(window).resize(function(){i=$("#wrapper").width(),s=$("#wrapper").height(),a(),$("#nav"+t).trigger("click");var e=$("#tableWrap").height();$("#tableContainer_inner").height(e-10)});var d=2;$("#installation").focus(function(){d=this.value}).change(function(){switch($("#installation").val()){case"0":hasDrawing()&&p(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,d),$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1);break;case"1":hasDrawing()&&p(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,d),$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!0),$("#optics_op3").prop("disabled",!0);break;case"2":hasDrawing()&&p(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,d),$("#susLength_lbl").show(),$("#susLength").show(),0!=$("#susLength :selected").val()&&5!=$("#susLength :selected").val()||($("#otherSusLen").show(),$("#otherSusLenLabel2").show()),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1)}}),$("#susLength").change(function(){0==$("#susLength :selected").val()||5==$("#susLength :selected").val()?($("#otherSusLen").show(),$("#otherSusLenLabel2").show()):($("#otherSusLen").hide(),$("#otherSusLenLabel2").hide())}),$("#color").change(function(){3==$("#color :selected").val()?($("#otherColorLabel").show(),$("#otherColorLabel2").show(),$("#otherColor").show()):($("#otherColorLabel").hide(),$("#otherColorLabel2").hide(),$("#otherColor").hide())});var c=0;function h(e,t,n,i){var s="<div class='dialog-ovelay'><div class='dialog'><header> <h3> "+e+" </h3> </header><div class='dialog-msg'> <p> "+t+" </p> </div><footer><div class='controls'> <button class='button button-default cancelAction'>"+i+"</button>  <button class='button button-danger doAction'>"+n+"</button> </div></footer></div></div>";$("body").prepend(s),$(".doAction").click(function(){console.log("submited! try to send mail..."),async function(){var e=await genProjectSummary();pdf=btoa(e.output()),$.ajax({url:"php/ley.php",data:{action:"sendMail",toMail:projectDef.contact.email,subject:strings.mail_subject,body:strings.mail_body,attachMail:pdf},type:"post",cache:!1,dataType:"json",success:function(e){console.log(e)}})}(),$(this).parents(".dialog-ovelay").fadeOut(500,function(){$(this).remove()})}),$(".cancelAction").click(function(){$(this).parents(".dialog-ovelay").fadeOut(500,function(){$(this).remove()})})}function g(){if(""==projectDef.project.room){var e=new Date,t=1+e.getMonth();return auxFinalName="Ley_"+e.getFullYear().toString()+t.toString()+e.getDate().toString()+e.getHours().toString()+e.getMinutes().toString(),auxFinalName}return projectDef.project.room.replace(/[ ,]+/g,"_")}function p(e,t,n,i,s){var o="<div class='dialog-ovelay'><div class='dialog'><header> <h3> "+e+" </h3> </header><div class='dialog-msg'> <p> "+t+" </p> </div><footer><div class='controls'> <button class='button button-default cancelAction'>"+i+"</button>  <button class='button button-danger doAction'>"+n+"</button> </div></footer></div></div>";$("body").prepend(o),$(".cancelAction").click(function(){switch($("#installation").val(s),$("#installation").val()){case"0":$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1);break;case"1":$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!0),$("#optics_op3").prop("disabled",!0);break;case"2":$("#susLength_lbl").show(),$("#susLength").show(),0!=$("#susLength :selected").val()&&5!=$("#susLength :selected").val()||($("#otherSusLen").show(),$("#otherSusLenLabel2").show()),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1)}$(this).parents(".dialog-ovelay").fadeOut(500,function(){$(this).remove()})}),$(".doAction").click(function(){cleanDesign(),reCalculateDesign(),setUpDesignMap(),$(this).parents(".dialog-ovelay").fadeOut(500,function(){$(this).remove()})})}function u(e,t,n,i,s){var o="<div class='dialog-ovelay'><div class='dialog'><header> <h3> "+e+" </h3> </header><div class='dialog-msg'> <p> "+t+" </p> </div><footer><div class='controls'> <button class='button button-default cancelAction'>"+i+"</button>  <button class='button button-danger doAction'>"+n+"</button> </div></footer></div></div>";$("body").prepend(o),$(".cancelAction").click(function(){switch($("#optics").val(s),$("#optics").val()){case"0":$("#lightOutputLabel").show(),$("#lightOutput").show(),$("#beamLabel").hide(),$("#beam").hide(),$("#installation_op1").prop("disabled",!1);break;case"2":case"3":$("#lightOutputLabel").hide(),$("#lightOutput").hide(),$("#beamLabel").show(),$("#beam").show(),$("#installation_op1").prop("disabled",!0)}$(this).parents(".dialog-ovelay").fadeOut(500,function(){$(this).remove()})}),$(".doAction").click(function(){switch($("#optics").val()){case"0":opticsMode=1,minSquares=4,gridSize=30,gridSizeInMM=280,minLenght=gridSize*minSquares;break;case"2":case"3":opticsMode=2,minSquares=3,gridSize=40,gridSizeInMM=456,minLenght=gridSize*minSquares}cleanDesign(),reCalculateDesign(),setUpDesignMap(),$(this).parents(".dialog-ovelay").fadeOut(500,function(){$(this).remove()})})}$("#optics").focus(function(){c=this.value}).change(function(){switch($("#optics :selected").val()){case"0":2!=c&&3!=c||(hasDrawing()?u(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,c):(opticsMode=1,minSquares=4,gridSize=30,gridSizeInMM=280,minLenght=gridSize*minSquares,cleanDesign(),setUpDesignMap())),$("#lightOutputLabel").show(),$("#lightOutput").show(),$("#beamLabel").hide(),$("#beam").hide(),$("#installation_op1").prop("disabled",!1);break;case"2":case"3":0!=c&&1!=c||(hasDrawing()?u(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,c):(opticsMode=2,minSquares=3,gridSize=40,gridSizeInMM=456,minLenght=gridSize*minSquares,cleanDesign(),setUpDesignMap())),$("#lightOutputLabel").hide(),$("#lightOutput").hide(),$("#beamLabel").show(),$("#beam").show(),$("#installation_op1").prop("disabled",!0)}}),$("input:radio[name=mouseToggle]").change(function(){mouseMode=this.value,0==mouseMode?($("#designContainer").css("cursor","crosshair"),null!==selSegment&&(selSegment=null,reCalculateDesign(),$("#delButton").addClass("btn_disabled"))):1==mouseMode&&$("#designContainer").css("cursor","default")}),$("#undoButton").click(function(){if(!$(this).hasClass("btn_disabled")){var e=drawLayer.find(".segments")[0];e.children.length&&(e.children.pop(),reCalculateDesign(),drawLayer.draw(),0==(e=drawLayer.find(".segments")[0]).children.length&&($(this).addClass("btn_disabled"),$("#calcButton").addClass("btn_disabled")))}}),$("#calcButton").click(function(){reCalculateDesign(),$(this).addClass("btn_disabled")}),$("#delButton").click(function(){if(null!=selSegment){var e=getDesignSegByID(selSegment);-1!==e&&canDelete(e)&&(segGrp.children.splice(e,1),reCalculateDesign(),selSegment=null)}else confirmDel(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel)}),$("#zoomFitButton").click(function(){zoomFit(designStage),zoomVars_design.origin=designStage.position(),designStage.draw()}),$(document).keyup(function(e){if("Delete"===e.key&&null!=selSegment){var t=getDesignSegByID(selSegment);-1!==t&&(segGrp.children.splice(t,1),reCalculateDesign(),selSegment=null)}}),$("#additionalnfo").blur(function(){projectDef.extra=$(this).val()}),$("#printButton").click(async function(){pdf=await genProjectSummary(),pdf.save("Ley-"+projectDef.project.name+"-"+projectDef.project.room+"-Datasheet.pdf")}),$("#submitButton").click(function(){h(strings.gdpr_title,strings.gdpr_text,strings.yes,strings.cancel)}),$("#installButton").click(function(){genInstallationSummary().save("Ley-"+projectDef.project.name+"-"+projectDef.project.room+"-Installation.pdf")}),document.getElementById("cadButton").addEventListener("click",function(){var e,t=projectDef.project.name;if(""==projectDef.project.room){var n=new Date,i=1+n.getMonth();e="Ley_"+n.getFullYear().toString()+i.toString()+n.getDate().toString()+n.getHours().toString()+n.getMinutes().toString()}else e=t.replace(/[ ,]+/g,"_");!function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}("Ley-"+e+"-"+projectDef.project.room.replace(/[ ,]+/g,"_")+"-2D-model.scr","PICKFIRST 1\r\nOSNAPCOORD 1\r\n-BEDIT "+g()+"\r\n-STYLE Attributes\r\ntxt.shx\r\n180\r\n1\r\n0\r\nNo\r\nNo\r\nNo\r\n-ATTDEF p\r\n\r\nSYMBOOL\r\n\r\n"+g()+"\r\nS Attributes\r\n"+StartPoint()+"\r\n"+RotationAngleFirstSegment(modules[0])+"\r\n-ATTDEF p\r\n\r\nINFO\r\n\r\n\r\nS Attributes\r\n"+LastPoint()+"\r\n"+RotationAngleFirstSegment(modules[0])+"\r\n"+EveryAutoCadSegment()+"MOVE ALL\r\n\r\nd\r\n"+MoveAll()+"\r\nBSAVE\r\nBCLOSE\r\n-INSERT "+g()+"\r\n")},!1)});