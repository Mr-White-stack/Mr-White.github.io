$((function(){var versionNr="",fieldsetCount=$("#formElem").children().length,current=1,stepsWidth=0,singleStepWidth=$("#wrapper").width(),stepsHeight=$("#wrapper").height(),widths=new Array;function setStepSizes(){stepsWidth=0,widths=new Array,$("#steps .step").each((function(i){var $step=$(this);$step.width(singleStepWidth),$step.height(stepsHeight),widths[i]=stepsWidth,stepsWidth+=singleStepWidth})),$("#steps").width(stepsWidth)}function validateSteps(){for(var FormErrors=!1,i=1;i<fieldsetCount;++i){var error;-1==validateStep(i)&&(FormErrors=!0)}$("#formElem").data("errors",FormErrors)}function validateStep(step){if(step!=fieldsetCount){var error=1,hasError=!1,$link;$("#formElem").children(":nth-child("+parseInt(step)+")").find(":input:not(button)").each((function(){var $this=$(this),valueLength;""==jQuery.trim($this.val()).length?(hasError=!0,$this.css("background-color","#FFEDEF")):$this.is(":disabled")||$this.css("background-color","#FFFFFF")})),$("#navigation li:nth-child("+parseInt(step)+") a").parent().find(".error,.checked").remove();var valclass="checked";switch(hasError&&(error=-1,valclass="error"),step){case 1:loadProjectDefData();break;case 2:loadLineCharacteristics()}return error}}function getTranslationFile(){var url;url="res/lang/"+locale+".json",$.ajax({global:!1,url:url,dataType:"json",success:function(data){strings=data,applyTranslations(),createChannelTable()}})}function applyTranslations(){$("#titleBar").html(strings.title+" "),$("#contentTitle").html(strings.title+" "),$("#stepTitle_0").html(strings.projDef),$("#nav1").html(strings.projDef),$("#stepDesc_0").html(strings.projDef_desc),$("#projLabel").html(strings.project),$("#pname_lbl").html(strings.name),$("#proom_lbl").html(strings.room),$("#proom").attr("placeholder",strings.roomEG),$("#paddr_lbl").html(strings.address),$("#date_lbl").html(strings.date),$("#contactLabel").html(strings.contact),$("#cname_lbl").html(strings.name),$("#caddr_lbl").html(strings.address),$("#country_lbl").html(strings.country),$("#country_op0").html(strings.country_be),$("#country_op1").html(strings.country_lu),$("#country_op2").html(strings.country_fr),$("#country_op3").html(strings.country_de),$("#country_op4").html(strings.country_nl),$("#country_op5").html(strings.country_pt),$("#country_op6").html(strings.country_es),$("#country_op7").html(strings.country_se),$("#country_op8").html(strings.other),$("#phone_lbl").html(strings.phone),$("#phone").attr("placeholder",strings.phoneEG),$("#email_lbl").html(strings.mail),$("#email").attr("placeholder",strings.mailEG),$("#stepTitle_1").html(strings.lineDef),$("#nav2").html(strings.lineDef),$("#stepDesc_1").html(strings.lineDef_desc),$("#installation_lbl").html(strings.installation),$("#installation_op0").html(strings.ceiling),$("#installation_op1").html(strings.wall),$("#installation_op2").html(strings.suspended),$("#susLength_lbl").html(strings.susType+": "),$("#susLen_op0").html(strings.other),$("#susLen_op5").html(strings.other),$("#susLength_gr0").attr("label",strings.powerSupplyBox),$("#susLength_gr1").attr("label",strings.minimalistic),$("#color_lbl").html(strings.color),$("#color_op0").html(strings.color_op0),$("#color_op1").html(strings.color_op1),$("#color_op2").html(strings.color_op2),$("#color_op3").html(strings.other),$("#otherColorLabel2").html(strings.colorRemark),$("#ledcolor_lbl").html(strings.ledColor),$("#optics_lbl").html(strings.optics),$("#optics_gr0").attr("label",strings.diffuser),$("#optics_gr1").attr("label",strings.shielded),$("#optics_op0").html(strings.opalDiffuser),$("#optics_op2").html(strings.whiteShielding),$("#optics_op3").html(strings.blackShielding),$("#lightOutputLabel").html(strings.lightOutput+": "),$("#lightOutput_op0").html(strings.medium),$("#lightOutput_op1").html(strings.low),$("#beamLabel").html(strings.lightDistribution),$("#beam_op0").html(strings.medBeam),$("#beam_op1").html(strings.vWideBeam),$("#stepTitle_2").html(strings.lineDsgn),$("#nav3").html(strings.lineDsgn),$("#stepDesc_2").html(strings.lineDsgn_desc),$("#stepTitle_3").html(strings.lineConf),$("#nav4").html(strings.lineConf),$("#stepDesc_3").html(strings.lineConf_desc),$("#stepTitle_4").html(strings.projSumm),$("#nav5").html(strings.projSumm),$("#stepDesc_4").html(strings.projSumm_desc),$("#pOverview_title").html(strings.projOverview),$("#addInfo").html(strings.addInfo),$("#additionalnfo").attr("placeholder",strings.addInfoPH+"."),$("#leyTitle").html(strings.ley),$("#components_title").html(strings.components),$("#tenderTitle").html(strings.tenderTitle),$("#printPopup").html(strings.printPopup),$("#submitPopup").html(strings.submitPopup),$("#orderPopup").html(strings.orderPopup),$("#autocadPopup").html(strings.autocadPopup),$("#installationPopup").html(strings.installationPopup),5==current&&(loadOverviewData(),genOverviewTable(modules))}$("#formElem").children(":first").find(":input:first").focus(),$("#backward").hide(),$("#backward").bind("click",(function(e){$("#nav"+(current-1)).trigger("click")})),$("#forward").bind("click",(function(e){$("#nav"+(current+1)).trigger("click")})),$("#navigation").show(),$("#nav2, #nav3, #nav4, #nav5").bind("click",(function(e){if(1==current&&(""==$("#email").val()||"blank"==$("#country :selected").val()))return validateStep(current),void warningMsg(strings.warningTitle,strings.warningMsg);var $this=$(this),prev=current;$this.closest("ul").find("li").removeClass("selected"),$this.parent().addClass("selected"),current=$this.parent().index()+1;for(var i=1;i<fieldsetCount;++i)i<current?$("#navlist").children(":nth-child("+i+")").addClass("prev"):$("#navlist").children(":nth-child("+i+")").removeClass("prev");switch($("#steps").stop().animate({marginLeft:"-"+widths[current-1]+"px"},500,(function(){for(var prevAux=prev;prevAux<current;)validateStep(prevAux),prevAux++;switch($("#formElem").children(":nth-child("+parseInt(current)+")").find(":input:first").focus(),current){case 1:$("#backward").hide();break;case 3:$("#designContainer").show(),$("#toolsWrapper").show(),designHasChanged=!1;break;case 4:$("#configContainer").show(),$("#tableWrap").show(),designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1);break;case 5:designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1),createPath(),$("#exportContainer").show(),$("#overviewContainer").show(),$("#submitPanel").show(),$("#forward").hide()}})),current){case 1:$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 2:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 3:$("#backward").show(),$("#forward").show(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 4:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 5:$("#backward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide()}e.preventDefault()})),$("#nav1").bind("click",(function(e){if(1!=current||""!=$("#email").val()&&"blank"!=$("#country :selected").val()){var $this=$(this),prev=current;$this.closest("ul").find("li").removeClass("selected"),$this.parent().addClass("selected"),current=$this.parent().index()+1;for(var i=1;i<fieldsetCount;++i)i<current?$("#navlist").children(":nth-child("+i+")").addClass("prev"):$("#navlist").children(":nth-child("+i+")").removeClass("prev");switch($("#steps").stop().animate({marginLeft:"-"+widths[current-1]+"px"},500,(function(){for(var prevAux=prev;prevAux<current;)validateStep(prevAux),prevAux++;switch($("#formElem").children(":nth-child("+parseInt(current)+")").find(":input:first").focus(),current){case 1:$("#backward").hide();break;case 3:$("#designContainer").show(),$("#toolsWrapper").show(),designHasChanged=!1;break;case 4:$("#configContainer").show(),$("#tableWrap").show(),designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1);break;case 5:designHasChanged&&(loadConfigMap(),createChannelTable(),designHasChanged=!1),createPath(),$("#exportContainer").show(),$("#overviewContainer").show(),$("#submitPanel").show(),$("#forward").hide()}})),current){case 1:$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 2:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 3:$("#backward").show(),$("#forward").show(),$("#configContainer").hide(),$("#tableWrap").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 4:$("#backward").show(),$("#forward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#exportContainer").hide(),$("#overviewContainer").hide(),$("#submitPanel").hide();break;case 5:$("#backward").show(),$("#designContainer").hide(),$("#toolsWrapper").hide(),$("#configContainer").hide(),$("#tableWrap").hide()}e.preventDefault()}else validateStep(current)})),$("#country").keydown((function(e){9==e.which&&($("#navigation li:nth-child(2) a").click(),$(this).blur(),e.preventDefault())})),$(document).ready((function(){var urlParams=new URLSearchParams(window.location.search);null!=urlParams.get("lang")&&(console.log(urlParams.get("lang")),locale=urlParams.get("lang")),$("#langSel").val(locale),getTranslationFile(),setStepSizes();var currentDate=new Date;$("#date").val(currentDate.toLocaleString("en-GB")),setUpDesignMap(),setUpConfigMap(),getCodesData()})),$("#langSel").change((function(){locale=$("#langSel :selected").val(),getTranslationFile()})),$(window).resize((function(){singleStepWidth=$("#wrapper").width(),stepsHeight=$("#wrapper").height(),setStepSizes(),$("#nav"+current).trigger("click");var wrapheight=$("#tableWrap").height();$("#tableContainer_inner").height(wrapheight-10)}));var prevInstallation=2;$("#installation").focus((function(){prevInstallation=this.value})).change((function(){switch($("#installation").val()){case"0":hasDrawing()&&confirmChangeInstall(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,prevInstallation),$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1);break;case"1":hasDrawing()&&confirmChangeInstall(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,prevInstallation),$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!0),$("#optics_op3").prop("disabled",!0);break;case"2":hasDrawing()&&confirmChangeInstall(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,prevInstallation),$("#susLength_lbl").show(),$("#susLength").show(),0!=$("#susLength :selected").val()&&5!=$("#susLength :selected").val()||($("#otherSusLen").show(),$("#otherSusLenLabel2").show()),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1)}})),$("#susLength").change((function(){0==$("#susLength :selected").val()||5==$("#susLength :selected").val()?($("#otherSusLen").show(),$("#otherSusLenLabel2").show()):($("#otherSusLen").hide(),$("#otherSusLenLabel2").hide())})),$("#color").change((function(){3==$("#color :selected").val()?($("#otherColorLabel").show(),$("#otherColorLabel2").show(),$("#otherColor").show()):($("#otherColorLabel").hide(),$("#otherColorLabel2").hide(),$("#otherColor").hide())}));var prevOptics=0;function gdprConfirm(title,msg,$true,$false){var $content="<div class='dialog-ovelay'><div class='dialog'><header> <h3> "+title+" </h3> </header><div class='dialog-msg'> <p> "+msg+" </p> </div><footer><div class='controls'> <button class='button button-default cancelAction'>"+$false+"</button>  <button class='button button-danger doAction'>"+$true+"</button> </div></footer></div></div>";$("body").prepend($content),$(".doAction").click((function(){console.log("submited! try to send mail..."),sendMail(),$(this).parents(".dialog-ovelay").fadeOut(500,(function(){$(this).remove()}))})),$(".cancelAction").click((function(){$(this).parents(".dialog-ovelay").fadeOut(500,(function(){$(this).remove()}))}))}async function sendMail(){var auxpdf=await genProjectSummary();pdf=btoa(auxpdf.output()),$.ajax({url:"php/ley.php",data:{action:"sendMail",toMail:projectDef.contact.email,subject:strings.mail_subject,body:strings.mail_body,attachMail:pdf},type:"post",cache:!1,dataType:"json",success:function(data){console.log(data)}})}function confirmChangeInstall(title,msg,$true,$false,previous){var $content="<div class='dialog-ovelay'><div class='dialog'><header> <h3> "+title+" </h3> </header><div class='dialog-msg'> <p> "+msg+" </p> </div><footer><div class='controls'> <button class='button button-default cancelAction'>"+$false+"</button>  <button class='button button-danger doAction'>"+$true+"</button> </div></footer></div></div>";$("body").prepend($content),$(".cancelAction").click((function(){switch($("#installation").val(previous),$("#installation").val()){case"0":$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1);break;case"1":$("#susLength_lbl").hide(),$("#susLength").hide(),$("#otherSusLen").hide(),$("#otherSusLenLabel2").hide(),$("#optics_op2").prop("disabled",!0),$("#optics_op3").prop("disabled",!0);break;case"2":$("#susLength_lbl").show(),$("#susLength").show(),0!=$("#susLength :selected").val()&&5!=$("#susLength :selected").val()||($("#otherSusLen").show(),$("#otherSusLenLabel2").show()),$("#optics_op2").prop("disabled",!1),$("#optics_op3").prop("disabled",!1)}$(this).parents(".dialog-ovelay").fadeOut(500,(function(){$(this).remove()}))})),$(".doAction").click((function(){cleanDesign(),reCalculateDesign(),setUpDesignMap(),$(this).parents(".dialog-ovelay").fadeOut(500,(function(){$(this).remove()}))}))}function confirmChangeOptics(title,msg,$true,$false,previous){var $content="<div class='dialog-ovelay'><div class='dialog'><header> <h3> "+title+" </h3> </header><div class='dialog-msg'> <p> "+msg+" </p> </div><footer><div class='controls'> <button class='button button-default cancelAction'>"+$false+"</button>  <button class='button button-danger doAction'>"+$true+"</button> </div></footer></div></div>";$("body").prepend($content),$(".cancelAction").click((function(){switch($("#optics").val(previous),$("#optics").val()){case"0":$("#lightOutputLabel").show(),$("#lightOutput").show(),$("#beamLabel").hide(),$("#beam").hide(),$("#installation_op1").prop("disabled",!1);break;case"2":case"3":$("#lightOutputLabel").hide(),$("#lightOutput").hide(),$("#beamLabel").show(),$("#beam").show(),$("#installation_op1").prop("disabled",!0)}$(this).parents(".dialog-ovelay").fadeOut(500,(function(){$(this).remove()}))})),$(".doAction").click((function(){switch($("#optics").val()){case"0":opticsMode=1,minSquares=4,gridSize=30,gridSizeInMM=280,minLenght=gridSize*minSquares;break;case"2":case"3":opticsMode=2,minSquares=3,gridSize=40,gridSizeInMM=456,minLenght=gridSize*minSquares}cleanDesign(),reCalculateDesign(),setUpDesignMap(),$(this).parents(".dialog-ovelay").fadeOut(500,(function(){$(this).remove()}))}))}$("#optics").focus((function(){prevOptics=this.value})).change((function(){var sel;switch($("#optics :selected").val()){case"0":2!=prevOptics&&3!=prevOptics||(hasDrawing()?confirmChangeOptics(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,prevOptics):(opticsMode=1,minSquares=4,gridSize=30,gridSizeInMM=280,minLenght=gridSize*minSquares,cleanDesign(),setUpDesignMap())),$("#lightOutputLabel").show(),$("#lightOutput").show(),$("#beamLabel").hide(),$("#beam").hide(),$("#installation_op1").prop("disabled",!1);break;case"2":case"3":0!=prevOptics&&1!=prevOptics||(hasDrawing()?confirmChangeOptics(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel,prevOptics):(opticsMode=2,minSquares=3,gridSize=40,gridSizeInMM=456,minLenght=gridSize*minSquares,cleanDesign(),setUpDesignMap())),$("#lightOutputLabel").hide(),$("#lightOutput").hide(),$("#beamLabel").show(),$("#beam").show(),$("#installation_op1").prop("disabled",!0)}})),$("input:radio[name=mouseToggle]").change((function(){mouseMode=this.value,0==mouseMode?($("#designContainer").css("cursor","crosshair"),null!==selSegment&&(selSegment=null,reCalculateDesign(),$("#delButton").addClass("btn_disabled"))):1==mouseMode&&$("#designContainer").css("cursor","default")})),$("#undoButton").click((function(){if(!$(this).hasClass("btn_disabled")){var segGrp=drawLayer.find(".segments")[0];segGrp.children.length&&(segGrp.children.pop(),reCalculateDesign(),drawLayer.draw(),0==(segGrp=drawLayer.find(".segments")[0]).children.length&&($(this).addClass("btn_disabled"),$("#calcButton").addClass("btn_disabled")))}})),$("#calcButton").click((function(){reCalculateDesign(),$(this).addClass("btn_disabled")})),$("#delButton").click((function(){if(null!=selSegment){var aux=getDesignSegByID(selSegment);-1!==aux&&canDelete(aux)&&(segGrp.children.splice(aux,1),reCalculateDesign(),selSegment=null)}else confirmDel(strings.dsgnDel_title,strings.dsgnDel_text,strings.yes,strings.cancel)})),$("#zoomFitButton").click((function(){zoomFit(designStage),zoomVars_design.origin=designStage.position(),designStage.draw()})),$(document).keyup((function(e){if("Delete"===e.key&&null!=selSegment){var aux=getDesignSegByID(selSegment);-1!==aux&&(segGrp.children.splice(aux,1),reCalculateDesign(),selSegment=null)}})),$("#additionalnfo").blur((function(){projectDef.extra=$(this).val()})),$("#printButton").click((async function(){pdf=await genProjectSummary(),pdf.save("Ley-Summary-"+projectDef.project.name+"-"+projectDef.project.room+"-Datasheet.pdf")})),$("#submitButton").click((function(){gdprConfirm(strings.gdpr_title,strings.gdpr_text,strings.yes,strings.cancel)})),$("#installButton").click((function(){var pdf;genInstallationSummary().save("Ley-"+projectDef.project.name+"-"+projectDef.project.room+"-Installation.pdf")}))}));